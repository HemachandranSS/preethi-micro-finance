<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Loans in India - Complete Guide with Definitions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #020c36 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2rem;
        }

        .section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            animation: slideInUp 0.8s ease-out;
            animation-fill-mode: both;
        }

        .section h2 {
            color: #4a5568;
            font-size: 2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            animation: pulse 2s infinite;
        }

        .definition-box {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4f1d4 100%);
            border-left: 4px solid #2ed573;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
        }

        .definition-box h4 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .definition-box p {
            color: #4a5568;
            line-height: 1.6;
        }

        .key-terms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .term-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }

        .term-card h5 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .term-card p {
            color: #718096;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .calculator {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
        }

        .calc-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input, .input-group select {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .input-group input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .input-group select {
            color: #333;
        }

        .calc-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .calc-button:hover {
            background: white;
            color: #f5576c;
            transform: scale(1.05);
        }

        .result {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .formula-box {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .example-calculation {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .interactive-demo {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
        }

        .amortization-table {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .amortization-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .amortization-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            position: sticky;
            top: 0;
            text-align: center;
            z-index: 10;
        }

        .amortization-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
            text-align: right;
        }

        .amortization-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .amortization-table tr:hover {
            background: #e3f2fd;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .math-steps {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4f1d4 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border-left: 4px solid #2ed573;
        }

        .math-steps h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .step {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            border-left: 3px solid #667eea;
        }

        .highlight-result {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            margin: 10px 0;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .info-panel {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .glossary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .glossary-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .glossary-card h5 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .glossary-card .definition {
            color: #4a5568;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .glossary-card .example {
            background: #f7fafc;
            padding: 10px;
            border-radius: 8px;
            font-style: italic;
            color: #718096;
            font-size: 0.9rem;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .calc-inputs { grid-template-columns: 1fr; }
            .comparison-grid { grid-template-columns: 1fr; }
            .glossary-grid { grid-template-columns: 1fr; }
            .key-terms { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Complete Loan Guide for India</h1>
            <p>Interactive calculators, mathematical formulas, and comprehensive definitions</p>
        </div>

        <!-- Comprehensive Definitions Section -->
        <div class="section">
            <h2>
                <div class="icon" style="background: linear-gradient(135deg, #2ed573, #1dd1a1);">📚</div>
                Essential Loan Definitions & Terms
            </h2>
            
            <div class="definition-box">
                <h4>What is a Loan?</h4>
                <p>A loan is a sum of money borrowed from a lender (like a bank) that must be repaid over time with interest. The borrower receives the principal amount upfront and repays it in installments along with interest charges.</p>
            </div>

            <div class="glossary-grid">
                <div class="glossary-card">
                    <h5>EMI (Equated Monthly Installment)</h5>
                    <div class="definition">A fixed monthly payment that includes both principal and interest components, calculated to fully repay the loan over the agreed tenure.</div>
                    <div class="example">Example: For a ₹10 lakh loan at 9% for 10 years, EMI = ₹12,668</div>
                </div>

                <div class="glossary-card">
                    <h5>Principal</h5>
                    <div class="definition">The original loan amount borrowed from the lender, excluding interest and fees.</div>
                    <div class="example">Example: If you borrow ₹25 lakhs for a home, the principal is ₹25 lakhs</div>
                </div>

                <div class="glossary-card">
                    <h5>Interest Rate</h5>
                    <div class="definition">The percentage charged by the lender for borrowing money, typically expressed as an annual percentage rate (APR).</div>
                    <div class="example">Example: 9.5% per annum means you pay 9.5% of the outstanding balance as interest annually</div>
                </div>

                <div class="glossary-card">
                    <h5>Tenure</h5>
                    <div class="definition">The total time period over which the loan must be repaid, usually expressed in years or months.</div>
                    <div class="example">Example: A 20-year home loan has a tenure of 240 months</div>
                </div>

                <div class="glossary-card">
                    <h5>Amortization</h5>
                    <div class="definition">The process of gradually paying off a loan through regular payments that cover both interest and principal reduction over time.</div>
                    <div class="example">Example: Early payments are mostly interest; later payments are mostly principal</div>
                </div>

                <div class="glossary-card">
                    <h5>Processing Fee</h5>
                    <div class="definition">A one-time charge levied by the lender for processing the loan application and documentation.</div>
                    <div class="example">Example: Typically 0.5% to 2% of loan amount, often with a minimum and maximum limit</div>
                </div>

                <div class="glossary-card">
                    <h5>Prepayment</h5>
                    <div class="definition">Making additional payments toward the loan principal before the scheduled due date to reduce interest burden.</div>
                    <div class="example">Example: Paying ₹2 lakhs extra in year 5 can save ₹3-4 lakhs in total interest</div>
                </div>

                <div class="glossary-card">
                    <h5>Foreclosure</h5>
                    <div class="definition">Completely paying off the entire outstanding loan balance before the end of the tenure.</div>
                    <div class="example">Example: Paying ₹15 lakhs to close a ₹15 lakh outstanding home loan early</div>
                </div>
            </div>
        </div>

        <!-- Enhanced EMI Calculator with Step-by-Step Math -->
        <div class="section">
            <h2>
                <div class="icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">🧮</div>
                EMI Calculator with Mathematical Breakdown
            </h2>
            
            <div class="definition-box">
                <h4>Understanding EMI Calculation</h4>
                <p>EMI (Equated Monthly Installment) is calculated using the compound interest formula, ensuring that each payment covers both interest on the outstanding balance and principal reduction. The formula balances these components so the loan is fully repaid over the specified tenure.</p>
            </div>
            
            <div class="formula-box">
                <h3>EMI Formula Explained:</h3>
                <p><strong>EMI = [P × R × (1+R)^N] / [(1+R)^N - 1]</strong></p>
                <p>Where:</p>
                <ul>
                    <li>P = Principal Loan Amount (₹)</li>
                    <li>R = Monthly Interest Rate (Annual Rate ÷ 12 ÷ 100)</li>
                    <li>N = Number of Monthly Installments (Years × 12)</li>
                    <li>(1+R)^N = Compound growth factor</li>
                </ul>
            </div>

            <div class="calculator">
                <h3>🎯 Interactive EMI Calculator</h3>
                <div class="calc-inputs">
                    <div class="input-group">
                        <label>Principal Amount (₹)</label>
                        <input type="number" id="principal" placeholder="2500000" value="2500000">
                    </div>
                    <div class="input-group">
                        <label>Annual Interest Rate (%)</label>
                        <input type="number" id="interestRate" placeholder="9.5" value="9.5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Loan Tenure (Years)</label>
                        <input type="number" id="tenureYears" placeholder="20" value="20">
                    </div>
                </div>
                <button class="calc-button" onclick="calculateEMIWithSteps()">Calculate EMI with Math Steps</button>
                <div class="result" id="emiResult">
                    Click Calculate to see detailed EMI breakdown
                </div>
            </div>

            <div id="mathSteps" class="math-steps" style="display: none;">
                <h4>📚 Step-by-Step Mathematical Calculation:</h4>
                <div id="calculationSteps"></div>
            </div>
        </div>

        <!-- Comprehensive Amortization Schedule -->
        <div class="section">
            <h2>
                <div class="icon" style="background: linear-gradient(135deg, #74b9ff, #0984e3);">📈</div>
                Complete Amortization Schedule & Analysis
            </h2>
            
            <div class="definition-box">
                <h4>What is Loan Amortization?</h4>
                <p>Amortization is the process of spreading loan payments over time, where each payment covers both interest on the outstanding balance and principal reduction. Early payments are interest-heavy, while later payments are principal-heavy. Understanding this helps in making informed prepayment decisions.</p>
            </div>
            
            <div class="interactive-demo">
                <h3>🔄 Dynamic Amortization Calculator</h3>
                <div class="calc-inputs">
                    <div class="input-group">
                        <label>Loan Amount: ₹<span id="amortPrincipalDisplay">2500000</span></label>
                        <input type="range" class="slider" min="500000" max="10000000" value="2500000" step="100000" id="amortPrincipalSlider">
                    </div>
                    <div class="input-group">
                        <label>Interest Rate: <span id="amortRateDisplay">9.5</span>%</label>
                        <input type="range" class="slider" min="7" max="18" value="9.5" step="0.1" id="amortRateSlider">
                    </div>
                    <div class="input-group">
                        <label>Tenure: <span id="amortTenureDisplay">20</span> years</label>
                        <input type="range" class="slider" min="5" max="30" value="20" id="amortTenureSlider">
                    </div>
                </div>
                
                <div class="highlight-result" id="amortSummary">
                    Adjust sliders to see real-time amortization changes
                </div>
            </div>

            <!-- Amortization Table -->
            <div class="amortization-table" id="amortizationTableContainer">
                <table id="amortizationTable">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>EMI (₹)</th>
                            <th>Interest (₹)</th>
                            <th>Principal (₹)</th>
                            <th>Outstanding (₹)</th>
                            <th>Cumulative Interest (₹)</th>
                        </tr>
                    </thead>
                    <tbody id="amortizationBody">
                    </tbody>
                </table>
            </div>

            <!-- Visual Chart -->
            <div class="chart-container">
                <h4>📊 Loan Balance vs Time Chart</h4>
                <canvas id="loanChart" width="800" height="250"></canvas>
            </div>
        </div>

        <!-- Interest Calculation Methods with Detailed Explanations -->
        <div class="section">
            <h2>
                <div class="icon" style="background: linear-gradient(135deg, #2ed573, #1dd1a1);">🔢</div>
                Interest Calculation Methods - Comprehensive Guide
            </h2>
            
            <div class="definition-box">
                <h4>Why Different Interest Calculation Methods Exist</h4>
                <p>Different lending products use different interest calculation methods based on the loan structure, risk profile, and market practices. Understanding these methods helps borrowers make informed decisions and avoid misconceptions about true borrowing costs.</p>
            </div>
            
            <div class="comparison-grid">
                <!-- Reducing Balance Method -->
                <div class="comparison-card" style="border-top-color: #2ed573;">
                    <h3>🔄 Reducing Balance Method</h3>
                    <div class="definition-box">
                        <h4>Definition</h4>
                        <p>Interest is calculated only on the outstanding loan balance, which reduces with each EMI payment. This is the most common and borrower-friendly method for term loans.</p>
                    </div>
                    <div class="formula-box">
                        <p><strong>Formula:</strong> Monthly Interest = Outstanding Balance × Monthly Rate</p>
                        <p><strong>Key Feature:</strong> Interest amount decreases over time as principal reduces</p>
                    </div>
                    <div class="interactive-demo">
                        <button class="calc-button" onclick="demonstrateReducingBalance()" style="background: #2ed573; border-color: #2ed573;">Calculate Example</button>
                        <div id="reducingResult" class="result" style="background: rgba(46, 213, 115, 0.2); color: #2d3748;">
                            Click to see reducing balance calculation with detailed breakdown
                        </div>
                    </div>
                </div>

                <!-- Flat Rate Method -->
                <div class="comparison-card" style="border-top-color: #ff6b6b;">
                    <h3>📏 Flat Rate Method</h3>
                    <div class="definition-box">
                        <h4>Definition</h4>
                        <p>Interest is calculated on the original principal amount for the entire tenure, regardless of how much has been repaid. This method is misleading as the effective rate is much higher than stated.</p>
                    </div>
                    <div class="formula-box">
                        <p><strong>Formula:</strong> Total Interest = Principal × Rate × Tenure</p>
                        <p><strong>Warning:</strong> Effective rate is approximately double the flat rate</p>
                    </div>
                    <div class="interactive-demo">
                        <button class="calc-button" onclick="demonstrateFlatRate()" style="background: #ff6b6b; border-color: #ff6b6b;">Calculate Example</button>
                        <div id="flatResult" class="result" style="background: rgba(255, 107, 107, 0.2); color: #2d3748;">
                            Click to see why flat rate is misleading
                        </div>
                    </div>
                </div>

                <!-- Compound Interest -->
                <div class="comparison-card" style="border-top-color: #667eea;">
                    <h3>📈 Compound Interest</h3>
                    <div class="definition-box">
                        <h4>Definition</h4>
                        <p>Interest is calculated not only on the principal but also on previously earned interest. Common in credit cards and overdue loan amounts.</p>
                    </div>
                    <div class="formula-box">
                        <p><strong>Formula:</strong> A = P(1 + r/n)^(nt)</p>
                        <p><strong>Danger Zone:</strong> Interest compounds exponentially, creating debt traps</p>
                    </div>
                    <div class="interactive-demo">
                        <button class="calc-button" onclick="demonstrateCompoundInterest()" style="background: #667eea; border-color: #667eea;">Calculate Example</button>
                        <div id="compoundResult" class="result" style="background: rgba(102, 126, 234, 0.2); color: #2d3748;">
                            Click to see the power (and danger) of compounding
                        </div>
                    </div>
                </div>

                <!-- Simple Interest -->
                <div class="comparison-card" style="border-top-color: #ffa502;">
                    <h3>📐 Simple Interest</h3>
                    <div class="definition-box">
                        <h4>Definition</h4>
                        <p>Interest calculated only on the principal amount for the specified period. Used in short-term loans and deposits.</p>
                    </div>
                    <div class="formula-box">
                        <p><strong>Formula:</strong> Interest = Principal × Rate × Time</p>
                        <p><strong>Usage:</strong> Short-term loans, fixed deposits, simple calculations</p>
                    </div>
                    <div class="interactive-demo">
                        <button class="calc-button" onclick="demonstrateSimpleInterest()" style="background: #ffa502; border-color: #ffa502;">Calculate Example</button>
                        <div id="simpleResult" class="result" style="background: rgba(255, 165, 2, 0.2); color: #2d3748;">
                            Click to see simple interest calculation
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-World Example Calculator -->
        <div class="section">
            <h2>
                <div class="icon" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);">🏠</div>
                Real-World Loan Examples
            </h2>
            
            <div class="comparison-grid">
                <div class="comparison-card" style="border-top-color: #667eea;">
                    <h3>🏠 Home Loan Example</h3>
                    <div class="example-calculation">
                        <p><strong>Typical Mumbai Apartment:</strong></p>
                        <p>Property Value: ₹1 Crore</p>
                        <p>Down Payment (20%): ₹20 Lakhs</p>
                        <p>Loan Amount: ₹80 Lakhs</p>
                        <p>Rate: 9.0% for 25 years</p>
                    </div>
                    <button class="calc-button" onclick="calculateHomeExample()" style="background: #667eea; border-color: #667eea; color: white;">Calculate</button>
                    <div id="homeExampleResult" class="result" style="background: rgba(102, 126, 234, 0.2); color: #2d3748;">
                        Click to see detailed calculation
                    </div>
                </div>

                <div class="comparison-card" style="border-top-color: #ff6b6b;">
                    <h3>🚗 Auto Loan Example</h3>
                    <div class="example-calculation">
                        <p><strong>Mid-range Car Purchase:</strong></p>
                        <p>Car Price: ₹15 Lakhs</p>
                        <p>Down Payment (20%): ₹3 Lakhs</p>
                        <p>Loan Amount: ₹12 Lakhs</p>
                        <p>Rate: 10.5% for 7 years</p>
                    </div>
                    <button class="calc-button" onclick="calculateAutoExample()" style="background: #ff6b6b; border-color: #ff6b6b; color: white;">Calculate</button>
                    <div id="autoExampleResult" class="result" style="background: rgba(255, 107, 107, 0.2); color: #2d3748;">
                        Click to see detailed calculation
                    </div>
                </div>

                <div class="comparison-card" style="border-top-color: #2ed573;">
                    <h3>💼 Personal Loan Example</h3>
                    <div class="example-calculation">
                        <p><strong>Wedding/Emergency Fund:</strong></p>
                        <p>Loan Amount: ₹5 Lakhs</p>
                        <p>Rate: 14% for 5 years</p>
                        <p>No Collateral Required</p>
                    </div>
                    <button class="calc-button" onclick="calculatePersonalExample()" style="background: #2ed573; border-color: #2ed573; color: white;">Calculate</button>
                    <div id="personalExampleResult" class="result" style="background: rgba(46, 213, 115, 0.2); color: #2d3748;">
                        Click to see detailed calculation
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Utility function to format numbers as Indian currency
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        maximumFractionDigits: 0
    }).format(amount);
}

function formatNumber(num) {
    return new Intl.NumberFormat('en-IN').format(Math.round(num));
}

// Main EMI Calculator with Step-by-Step Math
function calculateEMIWithSteps() {
    const principal = parseFloat(document.getElementById('principal').value) || 0;
    const annualRate = parseFloat(document.getElementById('interestRate').value) || 0;
    const tenureYears = parseFloat(document.getElementById('tenureYears').value) || 0;
    
    if (principal <= 0 || annualRate <= 0 || tenureYears <= 0) {
        document.getElementById('emiResult').innerHTML = '⚠️ Please enter valid positive values for all fields';
        return;
    }
    
    const monthlyRate = annualRate / 12 / 100;
    const numPayments = tenureYears * 12;
    
    // Calculate EMI using the standard formula
    const numerator = principal * monthlyRate * Math.pow(1 + monthlyRate, numPayments);
    const denominator = Math.pow(1 + monthlyRate, numPayments) - 1;
    const emi = numerator / denominator;
    
    const totalPayment = emi * numPayments;
    const totalInterest = totalPayment - principal;
    
    // Display main result
    document.getElementById('emiResult').innerHTML = `
        <div style="text-align: center;">
            <h3>💰 EMI Breakdown</h3>
            <div style="font-size: 1.5rem; margin: 10px 0;">
                <strong>Monthly EMI: ${formatCurrency(emi)}</strong>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">Principal</div>
                    <div style="font-weight: bold;">${formatCurrency(principal)}</div>
                </div>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">Total Interest</div>
                    <div style="font-weight: bold;">${formatCurrency(totalInterest)}</div>
                </div>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">Total Amount</div>
                    <div style="font-weight: bold;">${formatCurrency(totalPayment)}</div>
                </div>
            </div>
        </div>
    `;
    
    // Show detailed mathematical steps
    const stepsHtml = `
        <div class="step">Step 1: Convert annual rate to monthly rate<br>
        Monthly Rate (R) = ${annualRate}% ÷ 12 ÷ 100 = ${(monthlyRate * 100).toFixed(4)}% = ${monthlyRate.toFixed(6)}</div>
        
        <div class="step">Step 2: Calculate number of payments<br>
        N = ${tenureYears} years × 12 months = ${numPayments} payments</div>
        
        <div class="step">Step 3: Calculate (1+R)^N<br>
        (1 + ${monthlyRate.toFixed(6)})^${numPayments} = ${Math.pow(1 + monthlyRate, numPayments).toFixed(4)}</div>
        
        <div class="step">Step 4: Apply EMI Formula<br>
        EMI = [P × R × (1+R)^N] ÷ [(1+R)^N - 1]<br>
        EMI = [${formatNumber(principal)} × ${monthlyRate.toFixed(6)} × ${Math.pow(1 + monthlyRate, numPayments).toFixed(4)}] ÷ [${Math.pow(1 + monthlyRate, numPayments).toFixed(4)} - 1]</div>
        
        <div class="step">Step 5: Calculate numerator and denominator<br>
        Numerator = ${numerator.toFixed(2)}<br>
        Denominator = ${denominator.toFixed(4)}</div>
        
        <div class="step">Step 6: Final EMI calculation<br>
        EMI = ${numerator.toFixed(2)} ÷ ${denominator.toFixed(4)} = <strong>${formatCurrency(emi)}</strong></div>
        
        <div class="step">Step 7: Total payment analysis<br>
        Total Amount = ${formatCurrency(emi)} × ${numPayments} months = ${formatCurrency(totalPayment)}<br>
        Total Interest = ${formatCurrency(totalPayment)} - ${formatCurrency(principal)} = ${formatCurrency(totalInterest)}<br>
        Interest as % of Principal = ${((totalInterest/principal) * 100).toFixed(1)}%</div>
    `;
    
    document.getElementById('calculationSteps').innerHTML = stepsHtml;
    document.getElementById('mathSteps').style.display = 'block';
    
    // Also update amortization with same values
    updateAmortizationFromEMI(principal, annualRate, tenureYears);
}

// Amortization Schedule Calculator
function generateAmortizationSchedule(principal, annualRate, tenureYears) {
    const monthlyRate = annualRate / 12 / 100;
    const numPayments = tenureYears * 12;
    
    const numerator = principal * monthlyRate * Math.pow(1 + monthlyRate, numPayments);
    const denominator = Math.pow(1 + monthlyRate, numPayments) - 1;
    const emi = numerator / denominator;
    
    let balance = principal;
    let cumulativeInterest = 0;
    const schedule = [];
    
    for (let month = 1; month <= numPayments; month++) {
        const interestPayment = balance * monthlyRate;
        const principalPayment = emi - interestPayment;
        balance -= principalPayment;
        cumulativeInterest += interestPayment;
        
        // Avoid negative balance due to rounding
        if (balance < 0) balance = 0;
        
        schedule.push({
            month: month,
            emi: emi,
            interest: interestPayment,
            principal: principalPayment,
            balance: balance,
            cumulativeInterest: cumulativeInterest
        });
        
        // Break if balance reaches zero
        if (balance <= 0.01) break;
    }
    
    return schedule;
}

function updateAmortizationFromEMI(principal, annualRate, tenureYears) {
    updateAmortizationDisplay(principal, annualRate, tenureYears);
}

// Update Amortization Display
function updateAmortizationDisplay(principal, annualRate, tenureYears) {
    const schedule = generateAmortizationSchedule(principal, annualRate, tenureYears);
    const totalInterest = schedule[schedule.length - 1].cumulativeInterest;
    const emi = schedule[0].emi;
    
    // Update summary
    document.getElementById('amortSummary').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">Monthly EMI</div>
                <div style="font-weight: bold; font-size: 1.1rem;">${formatCurrency(emi)}</div>
            </div>
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">Total Interest</div>
                <div style="font-weight: bold; font-size: 1.1rem;">${formatCurrency(totalInterest)}</div>
            </div>
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">Total Amount</div>
                <div style="font-weight: bold; font-size: 1.1rem;">${formatCurrency(principal + totalInterest)}</div>
            </div>
            <div>
                <div style="font-size: 0.9rem; opacity: 0.8;">Interest %</div>
                <div style="font-weight: bold; font-size: 1.1rem;">${((totalInterest/principal)*100).toFixed(1)}%</div>
            </div>
        </div>
    `;
    
    // Generate table rows (show first 12 months, then every 12th month)
    let tableHtml = '';
    schedule.forEach((row, index) => {
        if (index < 12 || (index + 1) % 12 === 0) {
            tableHtml += `
                <tr>
                    <td>${row.month}</td>
                    <td>${formatCurrency(row.emi)}</td>
                    <td>${formatCurrency(row.interest)}</td>
                    <td>${formatCurrency(row.principal)}</td>
                    <td>${formatCurrency(row.balance)}</td>
                    <td>${formatCurrency(row.cumulativeInterest)}</td>
                </tr>
            `;
        }
    });
    
    document.getElementById('amortizationBody').innerHTML = tableHtml;
    
    // Update chart (simplified version)
    drawLoanChart(schedule);
}

// Simple chart drawing function
function drawLoanChart(schedule) {
    const canvas = document.getElementById('loanChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    
    ctx.clearRect(0, 0, width, height);
    
    // Draw axes
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(50, height - 50);
    ctx.lineTo(width - 20, height - 50);
    ctx.moveTo(50, height - 50);
    ctx.lineTo(50, 20);
    ctx.stroke();
    
    // Draw loan balance curve
    if (schedule.length > 1) {
        ctx.strokeStyle = '#667eea';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        const maxBalance = schedule[0].balance;
        const maxMonth = schedule.length;
        
        schedule.forEach((point, index) => {
            const x = 50 + ((width - 70) * index) / maxMonth;
            const y = height - 50 - ((height - 70) * point.balance) / maxBalance;
            
            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        
        ctx.stroke();
    }
    
    // Add labels
    ctx.fillStyle = '#333';
    ctx.font = '12px Arial';
    ctx.fillText('Outstanding Balance', width / 2 - 50, 15);
    ctx.fillText('Months', width - 50, height - 25);
    
    // Rotate and add Y-axis label
    ctx.save();
    ctx.translate(15, height / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.fillText('Amount (₹)', -30, 0);
    ctx.restore();
}

// Slider event handlers
function setupAmortizationSliders() {
    const principalSlider = document.getElementById('amortPrincipalSlider');
    const rateSlider = document.getElementById('amortRateSlider');
    const tenureSlider = document.getElementById('amortTenureSlider');
    
    if (!principalSlider || !rateSlider || !tenureSlider) return;
    
    function updateFromSliders() {
        const principal = parseFloat(principalSlider.value);
        const rate = parseFloat(rateSlider.value);
        const tenure = parseFloat(tenureSlider.value);
        
        document.getElementById('amortPrincipalDisplay').textContent = formatNumber(principal);
        document.getElementById('amortRateDisplay').textContent = rate;
        document.getElementById('amortTenureDisplay').textContent = tenure;
        
        updateAmortizationDisplay(principal, rate, tenure);
    }
    
    principalSlider.addEventListener('input', updateFromSliders);
    rateSlider.addEventListener('input', updateFromSliders);
    tenureSlider.addEventListener('input', updateFromSliders);
    
    // Initial calculation
    updateFromSliders();
}

// Interest Method Demonstrations
function demonstrateReducingBalance() {
    const principal = 500000;
    const rate = 12;
    const years = 5;
    
    const monthlyRate = rate / 12 / 100;
    const months = years * 12;
    const emi = (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                (Math.pow(1 + monthlyRate, months) - 1);
    
    let balance = principal;
    let totalInterest = 0;
    let month1Interest = balance * monthlyRate;
    let month1Principal = emi - month1Interest;
    balance -= month1Principal;
    let month2Interest = balance * monthlyRate;
    
    document.getElementById('reducingResult').innerHTML = `
        <h4>📉 Reducing Balance Example (₹${formatNumber(principal)} at ${rate}%)</h4>
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.6;">
            <strong>EMI: ${formatCurrency(emi)}</strong><br>
            Month 1: Interest = ${formatCurrency(month1Interest)}, Principal = ${formatCurrency(month1Principal)}<br>
            Month 2: Interest = ${formatCurrency(month2Interest)} (reduced as balance decreased)<br>
            <strong>Total Interest over ${years} years: ${formatCurrency((emi * months) - principal)}</strong><br>
            ✅ Interest reduces each month as principal is paid down
        </div>
    `;
}

function demonstrateFlatRate() {
    const principal = 500000;
    const flatRate = 12;
    const years = 5;
    
    const totalFlatInterest = principal * flatRate * years / 100;
    const totalAmount = principal + totalFlatInterest;
    const emi = totalAmount / (years * 12);
    
    // Calculate equivalent reducing balance rate
    const effectiveRate = flatRate * 2; // Approximate
    
    document.getElementById('flatResult').innerHTML = `
        <h4>⚠️ Flat Rate Trap Example (₹${formatNumber(principal)} at ${flatRate}% flat)</h4>
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.6;">
            <strong>Advertised Rate: ${flatRate}% "flat"</strong><br>
            Total Interest: ${formatCurrency(totalFlatInterest)} (on full principal always)<br>
            EMI: ${formatCurrency(emi)}<br>
            <strong>⚠️ Effective Rate: ~${effectiveRate}%</strong> (double the flat rate!)<br>
            ❌ You pay interest on money you've already returned
        </div>
    `;
}

function demonstrateCompoundInterest() {
    const principal = 10000;
    const rate = 3; // Monthly rate for credit cards
    const months = 12;
    
    let amount = principal;
    for (let i = 0; i < months; i++) {
        amount = amount * (1 + rate / 100);
    }
    
    const totalInterest = amount - principal;
    const effectiveAnnualRate = Math.pow(1 + rate / 100, 12) - 1;
    
    document.getElementById('compoundResult').innerHTML = `
        <h4>🔄 Compound Interest Warning (₹${formatNumber(principal)} at ${rate}%/month)</h4>
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.6;">
            <strong>Initial Amount: ${formatCurrency(principal)}</strong><br>
            After 12 months: ${formatCurrency(amount)}<br>
            Total Interest: ${formatCurrency(totalInterest)}<br>
            <strong>⚠️ Effective Annual Rate: ${(effectiveAnnualRate * 100).toFixed(1)}%</strong><br>
            💀 This is why credit card debt is dangerous!
        </div>
    `;
}

function demonstrateSimpleInterest() {
    const principal = 100000;
    const rate = 8;
    const years = 2;
    
    const interest = principal * rate * years / 100;
    const totalAmount = principal + interest;
    
    document.getElementById('simpleResult').innerHTML = `
        <h4>➗ Simple Interest Example (₹${formatNumber(principal)} at ${rate}% for ${years} years)</h4>
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.6;">
            <strong>Principal: ${formatCurrency(principal)}</strong><br>
            Interest = P × R × T / 100<br>
            Interest = ${formatNumber(principal)} × ${rate} × ${years} / 100 = ${formatCurrency(interest)}<br>
            <strong>Total Amount: ${formatCurrency(totalAmount)}</strong><br>
            ✅ Used in fixed deposits and short-term loans
        </div>
    `;
}

// Real-world examples
function calculateHomeExample() {
    const principal = 8000000; // 80 lakhs
    const rate = 9.0;
    const years = 25;
    
    const monthlyRate = rate / 12 / 100;
    const months = years * 12;
    const emi = (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                (Math.pow(1 + monthlyRate, months) - 1);
    
    const totalAmount = emi * months;
    const totalInterest = totalAmount - principal;
    
    document.getElementById('homeExampleResult').innerHTML = `
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.8;">
            <strong>🏠 Home Loan Analysis:</strong><br>
            Monthly EMI: <strong>${formatCurrency(emi)}</strong><br>
            Total Interest: ${formatCurrency(totalInterest)}<br>
            Total Payment: ${formatCurrency(totalAmount)}<br>
            Interest vs Principal: ${((totalInterest/principal)*100).toFixed(0)}%<br>
            <em>💡 Tip: Extra ₹10,000/month can save ₹15+ lakhs!</em>
        </div>
    `;
}

function calculateAutoExample() {
    const principal = 1200000; // 12 lakhs
    const rate = 10.5;
    const years = 7;
    
    const monthlyRate = rate / 12 / 100;
    const months = years * 12;
    const emi = (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                (Math.pow(1 + monthlyRate, months) - 1);
    
    const totalAmount = emi * months;
    const totalInterest = totalAmount - principal;
    
    document.getElementById('autoExampleResult').innerHTML = `
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.8;">
            <strong>🚗 Auto Loan Analysis:</strong><br>
            Monthly EMI: <strong>${formatCurrency(emi)}</strong><br>
            Total Interest: ${formatCurrency(totalInterest)}<br>
            Total Payment: ${formatCurrency(totalAmount)}<br>
            Car depreciation + Interest = Total cost<br>
            <em>💡 Consider shorter tenure to save interest</em>
        </div>
    `;
}

function calculatePersonalExample() {
    const principal = 500000; // 5 lakhs
    const rate = 14;
    const years = 5;
    
    const monthlyRate = rate / 12 / 100;
    const months = years * 12;
    const emi = (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                (Math.pow(1 + monthlyRate, months) - 1);
    
    const totalAmount = emi * months;
    const totalInterest = totalAmount - principal;
    
    document.getElementById('personalExampleResult').innerHTML = `
        <div style="text-align: left; font-size: 0.9rem; line-height: 1.8;">
            <strong>💼 Personal Loan Analysis:</strong><br>
            Monthly EMI: <strong>${formatCurrency(emi)}</strong><br>
            Total Interest: ${formatCurrency(totalInterest)}<br>
            Total Payment: ${formatCurrency(totalAmount)}<br>
            High interest due to no collateral<br>
            <em>⚠️ Use only for urgent needs, repay ASAP</em>
        </div>
    `;
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Set up amortization sliders
    setupAmortizationSliders();
    
    // Initial calculation for main EMI calculator
    if (document.getElementById('principal')) {
        calculateEMIWithSteps();
    }
    
    console.log('Loan calculator JavaScript loaded successfully!');
});

// Handle any missing elements gracefully
window.addEventListener('load', function() {
    // Double-check that all elements are available
    const elements = [
        'principal', 'interestRate', 'tenureYears', 'emiResult',
        'amortPrincipalSlider', 'amortRateSlider', 'amortTenureSlider'
    ];
    
    elements.forEach(id => {
        const element = document.getElementById(id);
        if (!element) {
            console.warn(`Element with ID '${id}' not found`);
        }
    });
});
    </script>